<script lang="ts">
import { Ref, ref } from 'vue'
import { asyncComputed } from '@vueuse/core';
import { SgroupsWithAttrs } from '@/my_types';
import * as api from '@/api'
</script>

<script setup lang="ts">
import SgroupLink from '@/components/SgroupLink.vue';
import MyIcon from '@/components/MyIcon.vue';
import { isEmpty } from 'lodash';
import { throttled_ref } from '@/vue_helpers';

let mygroups = asyncComputed(api.mygroups)

let search_token = throttled_ref('', 3)
let searching = ref(false)
let search_results = asyncComputed(async () => {
    const token = search_token.throttled
    return token ? api.search_sgroups({ sizelimit: 10, search_token: token, right: "updater" }) : undefined
}, null, searching)
</script>

<template>
<fieldset>
    <legend><h3>Recherche</h3></legend>
    <input v-model="search_token.real">
    <div v-if="search_token.throttled || searching">            
        <h4>RÃ©sultats</h4>
        <div v-if="searching">...</div>
        <div v-else-if="isEmpty(search_results)"><i>Aucun</i></div>
        <ul v-else>
            <li v-for="(attrs, id) in search_results">
                <MyIcon :name="id.endsWith('.') ? 'folder' : 'users'" class="on-the-left" />
                <SgroupLink :attrs="attrs" :id="id" />
            </li>
        </ul>
    </div>
</fieldset>
<fieldset>
    <legend><h3>Mes groupes</h3></legend>
    <div v-if="!mygroups">Veuillez patentier...</div>
    <div v-else-if="isEmpty(mygroups)"> <p></p> <i>Aucun</i> </div>    
    <ul v-else>
        <li v-for="(attrs, id) in mygroups">
            <MyIcon name="users" class="on-the-left" />
            <SgroupLink :attrs="attrs" :id="id" />
        </li>
    </ul>
</fieldset>
</template>
