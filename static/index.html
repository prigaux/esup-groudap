<!DOCTYPE html>
<html>

<pre id="x"></pre>

<script>

async function login() {
    const cfg = await (await fetch("/api/config/public")).json()
    if (cfg && cfg.cas_prefix_url) {
        document.location.href = cfg.cas_prefix_url + "/login?service=http://localhost:8000/api/login"
    }
}

async function api(api_function) {
    const response = await fetch("/api/" + api_function);
    console.log(response);
    if (response.status === 200) {
        const json = await response.json()
        console.log(json)
        return json
    }
    if (response.status === 401) {
        await login()
        return new Promise() // return dead promise
    }
    throw new Error(response)
}

async function doit() {
    const mygroups = await api("mygroups");
    document.getElementById("x").innerText = JSON.stringify(mygroups, undefined, '  ')
}

doit();

</script>

</html>
